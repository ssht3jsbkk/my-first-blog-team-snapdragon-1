<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>blogs</title>
    <script src="//cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js" type="text/javascript"></script>
  </head>
  <body onload="listBlogs()">
    <form class="form-control">
      <fieldset>
       <legend>Blog information:</legend>
      <label>Name of Author:</label><input name="author" type="text" class="author"><br>
      <br />
      <label>Title:</label><input name="title" type="text" class="title"><br>
      <br />
      <label>Date:</label><input name= "date" type="date" class="date"><br>
      <br />
      <label>Content:</label><input name= "content" type="text" class="content"<br>


    </form><br >
    <br />
    <br />
    <button onclick="addBlog()">Add new blog</button>
    <div id="blogs" />
  </body>
  <script>
  document.getElementsByClassName("form-control").addEventListener("submit", stopSubmit());

  function stopSubmit(event){
    event.preventDefault();
  }

  function addBlog() {
    var author = encodeURIComponent(document.getElementsByClassName("author")[0].value);
    var title = encodeURIComponent(document.getElementsByClassName("title")[0].value);
    var date = encodeURIComponent(document.getElementsByClassName("date")[0].value);
    var content = encodeURIComponent(document.getElementsByClassName("content")[0].value);
    var parameters = "author=" + author + "&title=" + title + "&date=" + date + "&content=" + content;

    var xhttp = new XMLHttpRequest();
    xhttp.open("POST", "/blogs", true);
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        listBlogs();
      };
    }
    xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded")
    xhttp.send(parameters);
   }

  function listBlogs() {
    var template = "<ul>{{#each blogs}}<li><h2>{{title}}</h2></li>{{/each}}</ul>";
    var xhttp = new XMLHttpRequest()
    xhttp.onreadystatechange = function() {
      if (this.readyState == 4 && this.status == 200) {
        //parse the blogs
        var blogs = JSON.parse(this.responseText);
        var compiledTemplate = Handlebars.compile(template);
        var renderedHTML = compiledTemplate({blogs: blogs});
        document.getElementById("blogs").innerHTML = renderedHTML;
      }
    };

    xhttp.open("GET", "/blogs", true);
    xhttp.send();
  }
  </script>
</html>
